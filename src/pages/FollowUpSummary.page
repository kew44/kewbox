<apex:page standardController="Client__c" showheader="true" extensions="FollowUpMockController" action="{!SummaryInit}">
    
    <!--JQuery -->
    <apex:includeScript value="{!URLFOR($Resource.jQuery, '/js/jquery-1.9.1.js')}"  /><!--allows for JQuery dependencies-->
    <script> $j = jQuery.noConflict(); </script><!--Reserves the '$' token for JQuery only-->
    
    <!-- Bootstrap -->
        <link href="{!URLFOR($Resource.VFbootstrap3, '/css/VFbootstrap.css')}" rel="stylesheet" media="screen"/>
            <apex:includeScript value="{!URLFOR($Resource.VFbootstrap3, '/js/bootstrap.min.js')}"/>
                <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet" />
                    
                    <!--link to the CSS resource in Salesforce internal document-->
                        <apex:stylesheet value="{!$Resource.CustomCss}" />
                            
                            <!--supplementary styling information-->
                                <style>
                                #sidebarCell { display: none;}
                            @media only screen and (min-width : 1224px) {
                                #sidebarCell { display: table-cell;}
                            }
                                #force .panel-default > .panel-heading { background-color: #FFFFFF !important; }
                            .trauma-status { color: #000 !important; }
                            </style>
                            <!--end styling-->
        
        <apex:outputPanel layout="none" rendered="{!if(openSection != '', true, false)}">
            <script>
            $j(document).ready(function() {
            $j('.sectionTitle{!openSection}').trigger('click');       
        });
                    </script>
</apex:outputPanel>

    <!-- "Breadcrumb" heading allows user to navigate to the ClientSummary page -->
<script>
$j(document).ready(function() {
    $j('.bPageTitle').append('<div class="ptBreadcrumb">&nbsp;Â«&nbsp;<a href="/a02/o">Back to Client List</a></div>');
});
</script>

<!--popup confirmation of new follow-up window-->
<script>
function confirmNew(url){
confirmWindow= window.open(url,'ConfirmNew', height=200, width=300');
if(window.focus{confirmWindow.focus()}
return false;
}
</script>
<!--end window function-->

    <!--Begin form content-->
<apex:sectionHeader title="Client Summary" subtitle="{!subtitle}"/>

        <!-- pageblock to show ClientInformation header as described in Utility class-->
<apex:pageBlock title="Client Information">
    <div id="force">
        <apex:outputText value="{!ClientInfo}" escape="false"/>
    </div>
</apex:pageBlock><!--end client info pageBlock--> 

<apex:pageBlock title="Client Summary">

    <div id="force">
        <section>
            <div class="panel-group" id="accordion"><!--class provides accordion-like folding or expanding behavior functionality-->
                <div id="baseline" class="panel panel-default">
                
                    <!--Baseline section heading-->
                    <div class="panel-heading">
                        <h4 class="panel-title">                            
                            <i class="fa fa-circle alert-sl-{!if(BaselineBtn = FALSE, 'green', 'red')}"></i><!--status indicator for baseline section-->
                            
                            <apex:outputPanel layout="none" rendered="{!BaselineBtn}">
                                Baseline<!--baseline title-->
                            </apex:outputPanel>                           
                           
                            <apex:outputPanel layout="none" rendered="{!NOT(BaselineBtn)}">
                                <a data-toggle="collapse" class="sectionTitle0" data-parent="#accordion" href="#collapseBase">Baseline</a> <!--invokes accordian behavior when baseline is clicked-->
                            </apex:outputPanel>
                            
                            <p class="pull-right">
                            
                                <!--visit date-->
                                <apex:outputPanel layout="none" rendered="{!NOT(BaselineBtn)}">                                    
                                    Date of Visit: &nbsp;
                                    <apex:outputText value="{0,date,MM/dd/yyyy}">
                                        <apex:param value="{!baselineDate}" />
                                    </apex:outputText>                                     
                                </apex:outputPanel>
                                <!--end visit date-->
                                
                                <!--begin start button-->
                                <apex:outputPanel layout="none" rendered="{!BaselineBtn}"><!--displays if baseline has not been started-->                                    
                                    <a href="{!URLFOR('/apex/DS_DEMO', null, ['cimi'=urlClientIDBaseDEMO])}">
                                        <button type="button" class="btn btn-primary btn-xs btn-sl">Start</button>
                                    </a>                                    
                                </apex:outputPanel>
                                <!--end start button-->                                
                            </p>
                        </h4>
                    </div>
                    <!--end baseline heading-->
                    
                    <div id="collapseBase" class="panel-collapse collapse">
                        <div class="panel-body">
                            <apex:outputPanel layout="none" rendered="{!NOT(BaselineBtn)}"><!--cannot display expanded baseline section unless it has been started-->
                            
                                <!--print button functionality-->
                                <a href="/apex/clientSummaryReport?cimi={!urlClientSummaryReport['0']}">
                                    <button type="button" class="btn btn-default pull-right">
                                        <i class="glyphicon glyphicon-list-alt"></i> &nbsp;Summary Report
                                    </button>
                                </a>
                                <!--end print button-->
                                
                                <table class="table table-hover">
                                    <!--heading-->
                                    <thead>
                                        <tr>
                                            <th>Instrument</th>
                                            <th>Status</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <!--end heading-->
                                    
                                    <tbody>
                                        <!--Displays System Screening-->
                                        <tr>                                            
                                            <td>System Screening</td><!--heading-->
                                            <td><i class="fa fa-circle alert-sl-green"></i> Complete</td><!--Status indicator-->
                                            <td>
                                                <a href="apex/DS_Base_SSI?id={!client.id}">
                                                    <button type="button" class="btn btn-primary btn-xs btn-sl">Edit</button><!--edit button-->
                                                </a>
                                            </td>
                                        </tr>
                                        <!--end system screening-->
                                        
                                        <!--expanded view, displays list of baseline form information relavent to client based on screening and registration-->
                                        <apex:repeat value="{!baseline}" var="base">
                                            <apex:outputPanel layout="none" rendered="{!NOT(AND(genderUnknown = true,base.Page__r.Gender_Required__c = true))}">
                                                <!--record of information about each form-->
                                                <tr>
                                                    <!--page title-->
                                                    <td>{!base.Page__r.Content__c}</td>
                                                    <!--end page title-->
                                                    
                                                    <!--status indicator-->
                                                    <td>
                                                        <i class="fa fa-circle alert-sl-{!CASE(base.STATUS__c,'Complete', 'green', 'Incomplete', 'yellow', 'red')}"></i> 
                                                        {!CASE(base.STATUS__c,'Complete', 'Complete', 'Incomplete', 'Incomplete', 'Not Started')}
                                                    </td>
                                                    <!--status indicator-->
                                                    
                                                    <!--start, edit, or view button depending on status and content-->
                                                    <td>
                                                        <a href="/apex/{!base.Page__r.Variable__c}{!if( AND( base.FORM_TYPE__c = 'Assessment', base.STATUS__c = 'Complete' ), '_Report', '')}?cimi={!urlSummary[base.id]}">
                                                            
                                                            <button type="button" class="btn btn-primary btn-xs btn-sl">
                                                                {!CASE(base.STATUS__c,'Complete', if(base.FORM_TYPE__c = 'Assessment', 'View', 'Edit'), 'Incomplete', 'Resume', 'Start')}
                                                            </button>
                                                        </a>
                                                    </td>
                                                    <!--end button-->
                                                </tr>
                                                <!--end record of information about each form-->                                                
                                            </apex:outputPanel>
                                                                                        
                                            <apex:outputPanel layout="none" rendered="{!AND(genderUnknown = true,base.Page__r.Gender_Required__c = true)}">
                                                <!--list of unavailable forms due to insufficient gender selection-->
                                                <tr>
                                                    <!--page title-->
                                                    <td class="td-disable">{!base.Page__r.Content__c}</td>
                                                    <!--end title-->
                                                    
                                                    <!--greyed out indicator-->
                                                    <td class="td-disable">
                                                        <i class="fa fa-circle alert-sl-gray"></i> 
                                                        Not Accessible
                                                    </td>
                                                    <!--end indicator-->
                                                    
                                                    <!--disabled button-->
                                                    <td class="td-disable">
                                                        <a title="If the clientâs sex is âdeclinedâ or âunknownâ, assessments that rely on gender for scoring will not be accessible.
                                                                  ">
                                                            <button type="button" class="btn btn-default btn-xs btn-sl" style="background-color:#DBD9D9;cursor: auto;">Start</button>
                                                        </a>
                                                    </td>
                                                    <!--end button-->
                                                    
                                                </tr>
                                                <!--end disabled record-->
                                            </apex:outputPanel>
                                        </apex:repeat>
                                        <!--end list of baseline form information-->                                                                                                                        
                                    </tbody>
                                </table>
                            </apex:outputPanel>
                        </div>
                    </div>
                </div>
                <!--end baseline section-->
                
                <!--trauma history section heading-->
                <div id="trauma-history" class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <i class="fa fa-circle alert-sl-{!if(traumaBtn = FALSE, 'green', 'red')}"></i><!--status indicator for trauma section-->
                            <apex:outputPanel layout="none" rendered="{!traumaBtn}">
                                Trauma History
                            </apex:outputPanel><!--trauma title-->
                            
                            <apex:outputPanel layout="none" rendered="{!NOT(traumaBtn)}">
                                <a data-toggle="collapse" class="sectionTitle-1" data-parent="#accordion" href="#collapseTrauma">Trauma History</a> <!--invokes accordian behavior when baseline is clicked-->
                            </apex:outputPanel>
                            
                            <p class="pull-right">
                            
                                <!--visit date-->
                                <apex:outputPanel layout="none" rendered="{!NOT(traumaBtn)}">
                                    Last Visit: &nbsp;
                                    <apex:outputText value="{0,date,MM/dd/yyyy}">
                                        <apex:param value="{!gtObj['GTDATE__c']}" />
                                    </apex:outputText> 
                                </apex:outputPanel>
                                <!--end visit date-->
                                
                                <!--begin start button-->
                                <apex:outputPanel layout="none" rendered="{!traumaBtn}">
                                    <a href="/apex/DS_GTRAUMA?cimi={!urlClientIDGTrauma}">
                                        <button type="button" class="btn btn-primary btn-xs btn-sl">Start</button>
                                    </a>
                                </apex:outputPanel>
                                <!--end start button-->
                            </p>
                        </h4>
                    </div>
                    <!--end trauma heading-->
                    
                    <div id="collapseTrauma" class="panel-collapse collapse">
                        <div class="panel-body">
                            <apex:outputPanel layout="none" rendered="{!NOT(traumaBtn)}"><!--cannot display expanded trauma section unless it has been started-->
                            
                            <!--edit general trauma button-->
                            <a href="/apex/DS_GTRAUMA?cimi={!urlClientIDGTrauma}">
                                    <button type="button" class="btn btn-default pull-right">
                                        <i class="fa fa-pencil"></i> &nbsp;Edit Trauma History
                                    </button>
                                </a>
                                <!--end general trauma button-->
                                
                                <table class="table table-hover">
                                    <!--heading-->
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Trauma Type</th>
                                            <th colspan="20">Age</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <!--end heading-->                                  
                                    <tbody>
                                        <!--display general trauma-->
                                        <apex:repeat value="{!rowsGTRAUMA}" var="gt">
                                            <tr>
                                                <!--record of information for trauma types and ages-->
                                                <td>{!gt.num}</td><!--number of trauma type-->
                                                <td>{!gt.trauma}</td><!--trauma type title-->
                                                <!--population of age indication-->
                                                <apex:repeat value="{!ageNum}" var="aNum">
                                                    <td class="text-center {!if(gtObj['GT'+gt.num+'RA'+aNum+'__c'] = true, 'info', '')}">
                                                        {!if(VALUE(aNum) < 10, '0'+aNum, aNum)}
                                                    </td>
                                                </apex:repeat>
                                                <!--end age indication-->
                                                <!--unknown field-->
                                                <td class="text-center {!if(gtObj['GT'+gt.num+'RAU__c'] = true, 'info', '')}">
                                                    Unk
                                                </td>
                                                <!--end unknown field-->
                                                
                                                <!--start, edit, or view button depending on status and content-->
                                                <td>
                                                    <apex:outputPanel rendered="{!if(gt.status != 'none', true, false)}" layout="none">
                                                        <a href="{!gt.url}"> 
                                                            <button type="button" class="btn btn-primary btn-xs btn-sl">
                                                                {!CASE(gt.status,'Complete', 'Edit', 'Incomplete', 'Resume', 'Start')}
                                                            </button>
                                                        </a>
                                                    </apex:outputPanel>
                                                </td>
                                                <!--end button-->
                                                
                                            </tr>
                                            <!--end record-->
                                        </apex:repeat>
                                    </tbody>
                                </table>
                            </apex:outputPanel>
                        </div>
                    </div>
                </div>
                <!--end trauma-->
    <!----------------------------------------------------------------------------------------------------------------------------------------------> 
    <apex:form >
                <div id="FollowUp" class="panel panel-default">
                
                <!--Follow-Up section heading-->
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <i class="fa fa-circle alert-sl-{!if(fuBtn = FALSE, 'green', 'red')}"></i><!--status indicator for follow-up section-->
                            
                            <apex:outputPanel layout="none" rendered="{!fuBtn}">
                                Follow-Up
                            </apex:outputPanel><!--follow-up title-->
                            
                            <apex:outputPanel layout="none" rendered="{!NOT(fuBtn)}">
                                <a data-toggle="collapse" class="sectionTitle-1" data-parent="#accordion" href="#collapseFU">Follow-Up</a> <!--invokes accordian behavior when fu is clicked-->
                                &nbsp;                                    
                            </apex:outputPanel>
                            
                            <p class="pull-right">
                            
                            <!--new follow-up form-->
                            <apex:outputPanel layout="none" rendered="{!NOT(fuBtn)}">
                            <apex:commandButton onclick="javascript:void window.open('/apex/FollowUpConfirmAdd?cimi={!urlClientID}','1414853221106','width=800,height=600,toolbar=0,menubar=0,location=1,status=1,scrollbars=1,resizable=1,left=0,top=0');" value="New Follow-Up"/>
                               <!-- <button type="button"  styleclass="padding:0px 0px" >New Follow-Up</button>class="btn btn-primary btn-xs" 
                                </apex:commandButton>
                            
                               <!-- <apex:actionSupport action="window.open('/apex/FollowUpConfirmAdd?cimi={!urlClientID}')" event="onclick()"  focus="confirmWindow"/>
                                     <a href="/apex/FollowUpConfirmAdd?cimi={!urlClientID}"  >
                                        
                                        <!--'/apex/FollowUpConfirmAdd?cimi={!urlClientID}'-->
                                    <!--onclick="if(!confirm('Are you sure?')){return};"Value="New Follow-up"-->
                                   <!-- </a>
                            <!--end new follow-up form-->
                            </apex:outputPanel>
                            </p>
                            
                        </h4>
                    </div>
                    <!--end follow-up heading-->
                                           
                    <div id="collapseFU" class="panel-collapse collapse">
                        <div class="panel-body">
                            <apex:outputPanel layout="none" rendered="{!NOT(fuBtn)}"><!--cannot display follow-up section unless followup has been started-->
                            
                                <table class="table table-hover">
                                    <!--heading-->
                                    <thead>
                                        <tr>
                                            <th>Record Name</th>
                                            <th>Record Date</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <!--end heading-->
                                    
                                    <tbody>
                                    
                                    <!--view list of follow-ups-->
                                    <apex:repeat value="{!followUP}" var="fu">
                                        <apex:outputPanel layout="none">
                                        <!--follow-up record-->
                                        <tr>
                                            <!--record title-->
                                            <td>Follow-up Number: </td>
                                            <!--end title-->
                                            
                                            <!--date-->
                                            <td>Date: &nbsp;
                                            <apex:outputText value="{0,date,MM/dd/yyyy}">
                                               <apex:param value="{!NOW()}" />
                                            </apex:outputText>
                                            </td>
                                            <!--end date-->
                                            
                                            <td>
                                            
                                     <a href="/apex/FollowUpSummary?cimi={!urlClientID}">
                                        <button type="button" class="btn btn-primary btn-xs" styleclass="padding:0px 0px" >View</button>
                                    </a>
                                            </td>
                                        </tr>
                                        <!--end follow-up record-->
                            </apex:outputPanel>
                            </apex:repeat>
                                    </tbody>
                                    </table>
                            </apex:outputPanel>
                        </div>
                    </div>
                    </div>
                    </apex:form>
    <!----------------------------------------------------------------------------------------------------------------------------------------------> 
            </div>
        </section>
    </div>
    <!--end client summary page-->
</apex:pageBlock>
</apex:page>